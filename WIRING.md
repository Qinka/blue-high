# 硬件接线说明

## STM32F103C8T6 引脚映射

### OLED 显示屏 (I2C 接口)

使用 I2C2 外设：

| OLED 引脚 | STM32 引脚 | 功能说明 |
|-----------|-----------|----------|
| VCC       | 3.3V      | 电源正极 |
| GND       | GND       | 电源负极 |
| SCL       | PB10      | I2C2 时钟线 |
| SDA       | PB11      | I2C2 数据线 |

**注意事项：**
- OLED 显示屏通常使用 SSD1306 控制器
- I2C 地址一般为 0x3C 或 0x3D
- 需要上拉电阻（通常模块自带）
- 电压为 3.3V，不要连接 5V

### E22-400M30S LoRa 模块 (SPI 接口)

使用 SPI1 外设，基于 SX1268 芯片：

| E22 引脚  | STM32 引脚 | 功能说明 |
|-----------|-----------|----------|
| VCC       | 3.3V      | 电源正极 |
| GND       | GND       | 电源负极 |
| MISO      | PA6       | SPI 主设备输入 |
| MOSI      | PA7       | SPI 主设备输出 |
| SCK       | PA5       | SPI 时钟 |
| NSS       | PA4       | SPI 片选信号 |
| BUSY      | PA3       | 忙状态指示 |
| DIO1      | PA2       | 数字 I/O 1（中断） |
| NRST      | PA1       | 复位引脚 |

**注意事项：**
- E22-400M30S 使用 SPI 接口通信，基于 Semtech SX1268 芯片
- SPI 模式：Mode 0 (CPOL=0, CPHA=0)
- SPI 时钟频率：1 MHz
- 工作频段: 410-493 MHz
- 发射功率: 最大 30 dBm (1W)
- 必须连接天线，否则可能损坏模块
- 工作电压为 3.3V (2.3V-5.5V)
- BUSY 引脚用于指示模块忙状态
- DIO1 用于中断信号
- 注意当地无线频率法规

## 完整接线图

```
STM32F103C8T6 蓝色开发板
┌──────────────────────────┐
│                          │
│  3.3V ──┬─── OLED VCC    │
│         └─── E22 VCC     │
│                          │
│  GND  ──┬─── OLED GND    │
│         └─── E22 GND     │
│                          │
│  PA1  ────── E22 NRST    │
│  PA2  ────── E22 DIO1    │
│  PA3  ────── E22 BUSY    │
│  PA4  ────── E22 NSS     │
│  PA5  ────── E22 SCK     │
│  PA6  ────── E22 MISO    │
│  PA7  ────── E22 MOSI    │
│                          │
│  PA11 ────── USB D-      │
│  PA12 ────── USB D+      │
│                          │
│  PB10 ────── OLED SCL    │
│  PB11 ────── OLED SDA    │
│                          │
└──────────────────────────┘

USB Type-C <---> PC
```

## 电源要求

- **电源电压**：3.3V（通过 USB 供电或外部稳压器）
- **电流消耗**：
  - STM32F103C8T6: ~10-30mA（运行时）
  - OLED 显示屏: ~20mA
  - LoRa 模块: ~120mA（发射时峰值）
- **建议电源**：能提供至少 200mA 的 3.3V 稳压电源

## ST-Link 连接

用于程序下载和调试：

| ST-Link | STM32F103C8T6 |
|---------|---------------|
| SWDIO   | SWDIO (PA13)  |
| SWCLK   | SWCLK (PA14)  |
| GND     | GND           |
| 3.3V    | 3.3V          |

## 常见问题

### OLED 无显示
1. 检查 I2C 接线是否正确
2. 确认 OLED 电源指示灯是否亮起
3. 检查 I2C 地址是否匹配（0x3C 或 0x3D）
4. 使用 I2C 扫描程序确认设备地址

### LoRa 无法通信
1. 确认天线已正确连接
2. 检查 SPI 接线（MISO、MOSI、SCK、NSS）
3. 确认 BUSY 和 DIO1 引脚连接正确
4. 检查 NRST 复位引脚
5. 使用逻辑分析仪检查 SPI 通信
6. 确保模块供电正常（3.3V）
7. 检查 SPI 时钟频率设置

### USB 通信问题
1. 确认 USB 线缆支持数据传输（非仅充电线）
2. 检查 PC 是否识别到 USB 设备
3. Windows 用户可能需要安装 USB CDC 驱动
4. 尝试更换 USB 端口或重新插拔
5. 使用设备管理器（Windows）或 `lsusb`（Linux）查看设备状态

### 编程/调试问题
1. 确认 ST-Link 驱动已正确安装
2. 检查 SWDIO 和 SWCLK 连接
3. 确保开发板已正确供电
4. 尝试按下复位按钮后重新连接
